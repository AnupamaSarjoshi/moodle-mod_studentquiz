define(["jquery"],function(a){function b(){f(),a(".studentquiz_behaviour .remove_action").off("click").on("click",function(){var b=a(this).closest("form").find(".cmid_field"),e=b.attr("value"),f=a(this).attr("data-question_id"),g=a(this).closest(".comments").children(".comment_list");a.post(a("#baseurlmoodle").val()+"/mod/studentquiz/remove.php",{id:a(this).attr("data-id"),cmid:e,sesskey:M.cfg.sesskey},function(){c(f,g,e)}).always(function(){d()})})}function c(c,d,e){var f=a("#baseurlmoodle").val()+"/mod/studentquiz/comment_list.php?questionid=";f+=c+"&cmid="+e+"&sesskey="+M.cfg.sesskey,a.get(f,function(a){d.html(a),b()})}function d(){""!=a(".add_comment_field").val()?e():f()}function e(){a(window).on("beforeunload",function(){return a(".studentquiz_behaviour > .comments > .comment_error").removeClass("hide"),!0})}function f(){a(".studentquiz_behaviour > .comments > .comment_error").addClass("hide"),a(window).off("beforeunload")}return{initialise:function(){a(".studentquiz_behaviour .add_comment").off("click").on("click",function(){f();var b=a(this).closest(".comments"),e=b.find(".add_comment_field"),g=e.attr("name").substr(1),h=a(this).closest("form").find(".cmid_field"),i=h.attr("value"),j=b.children(".comment_list");a.post(M.cfg.wwwroot+"/mod/studentquiz/save.php",{save:"comment",cmid:i,questionid:g,sesskey:M.cfg.sesskey,text:e.val()},function(){e.val(""),c(g,j,i)}).always(function(){d()})}),a(".studentquiz_behaviour .rate .rating .rateable").off("click").on("click",function(){f();var b=a(this).attr("data-rate"),c=a(this),e=a(this).closest("form").find(".cmid_field"),g=e.attr("value");a.post(M.cfg.wwwroot+"/mod/studentquiz/save.php",{save:"rate",cmid:g,questionid:a(this).attr("data-questionid"),sesskey:M.cfg.sesskey,rate:b},function(){var d=c.closest(".rating").children("span");d.removeClass("star"),d.addClass("star-empty"),d.each(function(){a(this).attr("data-rate")<=b&&(a(this).removeClass("star-empty"),a(this).addClass("star"))}),a(".studentquiz_behaviour > .rate > .rate_error").addClass("hide")}).always(function(){d()})}),a('input[name="next"], input[name="previous"], input[name="finish"]').off("click").on("click",function(){var b=a(this);if(!a('.im-controls input[type="submit"]').length||a('.im-controls input[type="submit"]').filter(function(){return this.name.match(/^q.+-submit$/)}).is(":disabled")){var c=!1;return a(".rating span").each(function(){a(this).hasClass("star")&&(c=!0)}),c?(b.submit(),!0):(a(".studentquiz_behaviour > .rate > .rate_error").removeClass("hide"),!1)}return b.submit(),!0}),a(".add_comment_field").on("keyup",d),b()}}});