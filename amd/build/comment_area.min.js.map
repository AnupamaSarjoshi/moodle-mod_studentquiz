{"version":3,"sources":["../src/comment_area.js"],"names":["define","$","str","ajax","ModalFactory","Templates","fragment","ModalEvents","t","EMPTY_CONTENT","ROOT_COMMENT_VALUE","GET_ALL_VALUE","TEMPLATE_COMMENTS","TEMPLATE_COMMENT","ACTION_CREATE","ACTION_CREATE_REPLY","ACTION_GET_ALL","ACTION_EXPAND","ACTION_DELETE","ACTION_EDIT","ACTION_LOAD_FRAGMENT_FORM","ACTION_LOAD_FRAGMENT_EDIT_FORM","ACTION_EXPAND_ALL","ACTION_COLLAPSE_ALL","ACTION_RENDER_COMMENT","ACTION_APPEND_COMMENT","ACTION_EDITOR_INIT","ACTION_INIT","ACTION_UPDATE_COMMENT_COUNT","ACTION_CLEAR_FORM","ACTION_SHOW_ERROR","FRAGMENT_FORM_CALLBACK","FRAGMENT_EDIT_FORM_CALLBACK","HAS_COMMENT_CLASS","ATTO_CONTENT_TYPE","HAS_CONTENT","NO_CONTENT","SELECTOR","CONTAINER","EXPAND_ALL","COLLAPSE_ALL","SUBMIT_BUTTON","CONTAINER_REPLIES","COMMENT_REPLIES_CONTAINER","COMMENT_COUNT","COMMENT_TEXT","COMMENT_HISTORY","COMMENT_REPLIES_TEXT","LOADING_ICON","COMMENT_AREA_FORM","FORM_SELECTOR","NO_COMMENT","COLLAPSE_LINK","EXPAND_LINK","COMMENT_ITEM","COMMENT_REPLIES_CONTAINER_TO_ITEM","FRAGMENT_FORM","BTN_DELETE","BTN_REPLY","BTN_DELETE_REPLY","ATTO_EDITOR_WRAP","TEXTAREA","COMMENT_COUNT_NUMBER","COMMENT_COUNT_TEXT","ATTO","CONTENT_WRAP","CONTENT","TOOLBAR","COMMENT_ID","SPAN_COMMENT_ID","TOTAL_REPLY","COMMENT_FILTER","COMMENT_FILTER_HIDE","COMMENT_ERROR","BTN_REPORT","COMMENT_FILTER_ITEM","COMMENT_FILTER_NAME","COMMENT_FILTER_TYPE","BTN_EDIT","BTN_EDIT_REPLY","ATTO_HTML_BUTTON","POST_FOOTER","get","elementSelector","btnExpandAll","btnCollapseAll","addComment","containerSelector","questionId","dialogue","loadingIcon","lastFocusElement","formSelector","contextId","userId","string","deleteDialog","deleteTarget","numberToShow","cmId","countServerData","lastCurrentCount","lastTotal","expand","forceCommenting","canViewDeleted","hasComment","referer","highlight","sortFeature","sortable","workingState","isNoComment","init","params","M","util","js_pending","self","escapeSelector","id","el","find","parseInt","data","count","total","sortfeature","forcecommenting","canviewdeleted","isnocomment","allowSelfCommentRating","allowselfcommentrating","initServerRender","initBindEditor","bindEvents","js_complete","changeWorkingState","each","attrs","replies","comment","deleted","numberofreply","expanded","root","bindCommentEvent","commentcount","updateCommentCount","hide","show","query","window","location","search","substring","getParams","parseQueryString","target","length","scrollToElement","isEditorLoaded","interval","setInterval","bindEditorEvent","clearInterval","editorWaiting","checkEditorContent","click","e","preventDefault","empty","getComments","then","response","countCommentAndReplies","renderComment","fail","err","showError","message","innerHTML","commentCount","deletedComments","totalDelete","addClass","rootId","unique","formData","convertFormToJson","attoWrap","hasClass","prepend","required","replyto","text","format","createComment","setTimeout","trigger","is","convertForTemplate","appendComment","handleFailWhenCreateComment","on","asc","sort","desc","nameSelector","iconSelector","type","orderBy","attr","isCurrent","ascString","descString","not","eachName","eachType","defaultString","removeClass","sortType","setSort","getParamsBeforeCallApi","numbertoshow","promise","call","methodname","args","questionid","cmid","when","error","done","showDialog","title","body","html","create","types","CANCEL","modal","getRoot","hidden","reload","current","s","get_string","noCommentSelector","filter","emptyReplies","checkEmptyElement","comments","render","i","hasOwnProperty","reply","bindReplyEvent","bindDeleteEvent","getFragmentFormReplyEvent","bindExpandEvent","bindCollapseEvent","getFragmentEditFormEvent","replySelector","boolean","elementToHide","visibility","prop","css","getFooter","focus","deleteCommentCount","replyCount","deleteReplyCount","constructor","Array","item","deletedtime","j","expandComment","commentid","itemSelector","key","clone","append","convertedItem","currentDisplayComment","newCount","newTotalCount","replaceWith","shortcontent","single","setHasComment","hascomment","reportlink","buildRefererReportLink","form","name","checked","val","isReply","parent","loadFragmentForm","fragmentForm","cancelbutton","remove","loadFragment","js","replaceNodeContents","textFragmentFormId","bindFragmentFormEvent","formFragmentSelector","appendTo","createReplyComment","fragmentFormCancelEvent","replyContainer","repliesEl","numReply","fragmentFormSelector","first","postFooter","isEdit","commentSelector","closest","DEFAULT","deletecomment","confirmdeletecomment","footer","deletetext","cancel","deleteComment","success","convertedCommentData","parentSelector","parentCountSelector","countSelector","oldReplies","shown","triggerAttoNoContent","fadeIn","textareaSelector","attoEditableId","attoEditable","document","getElementById","observation","MutationObserver","mutationsList","forEach","mutation","attributeName","observe","attributes","childList","subtree","change","children","value","container","hasCommentClass","vars","split","queryString","pair","decodeURIComponent","push","speed","top","offset","animate","scrollTop","link","encodeURIComponent","triggerAttoHasContent","editorContentWrap","submitBtn","placeholder","inArray","loadFragmentEditForm","bindFragmentEditFormEvent","editCommentEvent","editComment","commentTextSelector","Date","now","attoEditableEle","indexOf","trim","generate"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/*\r\n * Control the element in comment area.\r\n *\r\n * @package mod_studentquiz\r\n * @copyright 2020 The Open University\r\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\n/**\r\n * @module mod_studentquiz/comment_element\r\n */\r\ndefine(['jquery', 'core/str', 'core/ajax', 'core/modal_factory', 'core/templates', 'core/fragment', 'core/modal_events'],\r\n    function ($, str, ajax, ModalFactory, Templates, fragment, ModalEvents) {\r\n        var t = {\r\n            EMPTY_CONTENT: ['<br><p><br></p>', '<p><br></p>', '<br>', ''],\r\n            ROOT_COMMENT_VALUE: 0,\r\n            GET_ALL_VALUE: 0,\r\n            TEMPLATE_COMMENTS: 'mod_studentquiz/comments',\r\n            TEMPLATE_COMMENT: 'mod_studentquiz/comment',\r\n            ACTION_CREATE: 'mod_studentquiz_create_comment',\r\n            ACTION_CREATE_REPLY: 'mod_studentquiz_create_reply',\r\n            ACTION_GET_ALL: 'mod_studentquiz_get_comments',\r\n            ACTION_EXPAND: 'mod_studentquiz_expand_comment',\r\n            ACTION_DELETE: 'mod_studentquiz_delete_comment',\r\n            ACTION_EDIT: 'mod_studentquiz_edit_comment',\r\n            ACTION_LOAD_FRAGMENT_FORM: 'mod_studentquiz_load_fragment_form',\r\n            ACTION_LOAD_FRAGMENT_EDIT_FORM: 'mod_studentquiz_load_fragment_edit_form',\r\n            ACTION_EXPAND_ALL: 'action_expand_all',\r\n            ACTION_COLLAPSE_ALL: 'action_collapse_all',\r\n            ACTION_RENDER_COMMENT: 'action_render_comment',\r\n            ACTION_APPEND_COMMENT: 'action_append_comment',\r\n            ACTION_EDITOR_INIT: 'action_editor_init',\r\n            ACTION_INIT: 'action_init',\r\n            ACTION_UPDATE_COMMENT_COUNT: 'action_update_comment_count',\r\n            ACTION_CLEAR_FORM: 'action_clear_form',\r\n            ACTION_SHOW_ERROR: 'action_show_error',\r\n            FRAGMENT_FORM_CALLBACK: 'commentform',\r\n            FRAGMENT_EDIT_FORM_CALLBACK: 'commenteditform',\r\n            HAS_COMMENT_CLASS: 'has-comment',\r\n            ATTO_CONTENT_TYPE: {\r\n                HAS_CONTENT: 'has-content',\r\n                NO_CONTENT: 'no-content'\r\n            },\r\n            SELECTOR: {\r\n                CONTAINER: '.studentquiz-comment-container',\r\n                EXPAND_ALL: '.studentquiz-comment-expand',\r\n                COLLAPSE_ALL: '.studentquiz-comment-collapse',\r\n                SUBMIT_BUTTON: '#id_submitbutton',\r\n                CONTAINER_REPLIES: '.studentquiz-container-replies',\r\n                COMMENT_REPLIES_CONTAINER: '.studentquiz-comment-replies',\r\n                COMMENT_COUNT: '.studentquiz-comment-postcount',\r\n                COMMENT_TEXT: '.studentquiz-comment-text-inside',\r\n                COMMENT_HISTORY: '.studentquiz-comment-history',\r\n                COMMENT_REPLIES_TEXT: '.studentquiz-comment-replies .studentquiz-comment-text .studentquiz-comment-text-inside',\r\n                LOADING_ICON: '.studentquiz-comment-loading',\r\n                COMMENT_AREA_FORM: 'div.comment-area-form',\r\n                FORM_SELECTOR: '.studentquiz-comment-postform > div.comment-area-form',\r\n                NO_COMMENT: '.no-comment',\r\n                COLLAPSE_LINK: '.studentquiz-comment-collapselink',\r\n                EXPAND_LINK: '.studentquiz-comment-expandlink',\r\n                COMMENT_ITEM: '.studentquiz-comment-item',\r\n                COMMENT_REPLIES_CONTAINER_TO_ITEM: '.studentquiz-comment-replies .studentquiz-comment-item',\r\n                FRAGMENT_FORM: '.studentquiz-comment-postfragmentform',\r\n                BTN_DELETE: '.studentquiz-comment-btndelete',\r\n                BTN_REPLY: '.studentquiz-comment-btnreply',\r\n                BTN_DELETE_REPLY: '.studentquiz-comment-btndeletereply',\r\n                ATTO_EDITOR_WRAP: '.editor_atto_wrap',\r\n                TEXTAREA: 'textarea[id^=\"id_editor_question_\"]',\r\n                COMMENT_COUNT_NUMBER: '.studentquiz-comment-count-number',\r\n                COMMENT_COUNT_TEXT: '.studentquiz-comment-count-text',\r\n                ATTO: {\r\n                    CONTENT_WRAP: '.editor_atto_content_wrap',\r\n                    CONTENT: '.editor_atto_content',\r\n                    TOOLBAR: '.editor_atto_toolbar'\r\n                },\r\n                COMMENT_ID: '#comment_',\r\n                // Is used when server render. We need to collect some stored data attributes to load events.\r\n                SPAN_COMMENT_ID: '#c',\r\n                TOTAL_REPLY: '.studentquiz-comment-totalreply',\r\n                COMMENT_FILTER: '.studentquiz-comment-filter',\r\n                COMMENT_FILTER_HIDE: '.hide-comment-filter',\r\n                COMMENT_ERROR: '.studentquiz-comment-container .comment-error',\r\n                BTN_REPORT: '.studentquiz-comment-btnreport',\r\n                COMMENT_FILTER_ITEM: '.studentquiz-comment-filter-item',\r\n                COMMENT_FILTER_NAME: '.studentquiz-comment-filter-name',\r\n                COMMENT_FILTER_TYPE: '.studentquiz-comment-filter-type',\r\n                BTN_EDIT: '.studentquiz-comment-btnedit',\r\n                BTN_EDIT_REPLY: '.studentquiz-comment-btneditreply',\r\n                ATTO_HTML_BUTTON: 'button.atto_html_button',\r\n                POST_FOOTER: '.studentquiz-comment-postfooter'\r\n            },\r\n            get: function () {\r\n                return {\r\n                    elementSelector: null,\r\n                    btnExpandAll: null,\r\n                    btnCollapseAll: null,\r\n                    addComment: null,\r\n                    containerSelector: null,\r\n                    questionId: null,\r\n                    dialogue: null,\r\n                    loadingIcon: null,\r\n                    lastFocusElement: null,\r\n                    formSelector: null,\r\n                    contextId: null,\r\n                    userId: null,\r\n                    string: {},\r\n                    deleteDialog: null,\r\n                    deleteTarget: null,\r\n                    numberToShow: 5,\r\n                    cmId: null,\r\n                    countServerData: [],\r\n                    lastCurrentCount: 0,\r\n                    lastTotal: 0,\r\n                    expand: false,\r\n                    forceCommenting: false,\r\n                    canViewDeleted: false,\r\n                    hasComment: false,\r\n                    referer: null,\r\n                    highlight: 0,\r\n                    sortFeature: null,\r\n                    sortable: [],\r\n                    workingState: false,\r\n                    isNoComment: false,\r\n\r\n                    /**\r\n                     * Init function.\r\n                     *\r\n                     * @param {Object} params\r\n                     */\r\n                    init: function (params) {\r\n                        M.util.js_pending(t.ACTION_INIT);\r\n                        var self = this;\r\n                        // Assign attribute.\r\n                        self.elementSelector = $('#' + $.escapeSelector(params.id));\r\n                        var el = self.elementSelector;\r\n\r\n                        self.btnExpandAll = el.find(t.SELECTOR.EXPAND_ALL);\r\n                        self.btnCollapseAll = el.find(t.SELECTOR.COLLAPSE_ALL);\r\n                        self.addComment = el.find(t.SELECTOR.SUBMIT_BUTTON);\r\n                        self.containerSelector = el.find(t.SELECTOR.CONTAINER_REPLIES);\r\n                        self.loadingIcon = el.find(t.SELECTOR.LOADING_ICON);\r\n                        self.formSelector = el.find(t.SELECTOR.FORM_SELECTOR);\r\n\r\n                        self.questionId = parseInt(el.data('questionid'));\r\n                        self.contextId = parseInt(el.data('contextid'));\r\n                        self.userId = parseInt(el.data('userid'));\r\n                        self.numberToShow = parseInt(el.data('numbertoshow'));\r\n                        self.cmId = parseInt(el.data('cmid'));\r\n\r\n                        self.countServerData = {\r\n                            count: params.count,\r\n                            total: params.total\r\n                        };\r\n\r\n                        self.expand = params.expand || false;\r\n                        self.referer = el.data('referer');\r\n                        self.sortFeature = params.sortfeature;\r\n                        self.sortable = el.data('sortable');\r\n\r\n                        // Get all language strings.\r\n                        self.string = el.data('strings');\r\n                        self.forceCommenting = params.forcecommenting;\r\n                        self.canViewDeleted = params.canviewdeleted;\r\n                        self.isNoComment = params.isnocomment;\r\n                        self.allowSelfCommentRating = params.allowselfcommentrating;\r\n\r\n                        self.initServerRender();\r\n                        if (params.allowselfcommentrating) {\r\n                            self.initBindEditor();\r\n                        }\r\n                        self.bindEvents();\r\n                        M.util.js_complete(t.ACTION_INIT);\r\n                    },\r\n\r\n                    /**\r\n                     * Init for server rendering.\r\n                     */\r\n                    initServerRender: function () {\r\n                        var self = this;\r\n                        self.changeWorkingState(true);\r\n                        $(t.SELECTOR.COMMENT_ITEM).each(function () {\r\n                            var id = $(this).data('id');\r\n                            var attrs = $(this).find(t.SELECTOR.SPAN_COMMENT_ID + id);\r\n                            var replies = [];\r\n                            if (self.expand) {\r\n                                replies = attrs.data('replies') || [];\r\n                            }\r\n                            var comment = {\r\n                                id: $(this).data('id'),\r\n                                deleted: attrs.data('deleted'),\r\n                                numberofreply: attrs.data('numberofreply'),\r\n                                expanded: self.expand,\r\n                                replies: replies,\r\n                                root: true\r\n                            };\r\n                            self.bindCommentEvent(comment);\r\n                        });\r\n\r\n                        // If expanded, current comment count is total comments + replies.\r\n                        var commentcount = self.expand ? self.countServerData.total : self.countServerData.count.commentcount;\r\n                        self.updateCommentCount(commentcount, self.countServerData.total);\r\n\r\n                        if (self.expand) {\r\n                            self.btnExpandAll.hide();\r\n                            self.btnCollapseAll.show();\r\n                        } else {\r\n                            self.btnExpandAll.show();\r\n                            self.btnCollapseAll.hide();\r\n                        }\r\n\r\n                        // Highlight.\r\n                        var query = window.location.search.substring(1);\r\n                        var getParams = self.parseQueryString(query);\r\n                        self.highlight = parseInt(getParams.highlight) || 0;\r\n                        // End set highlight.\r\n\r\n                        // Scroll to.\r\n                        if (self.highlight !== 0) {\r\n                            var target = $(t.SELECTOR.COMMENT_ID + self.highlight);\r\n                            if (target.length) {\r\n                                self.scrollToElement(target);\r\n                            }\r\n                        }\r\n\r\n                        self.changeWorkingState(false);\r\n                    },\r\n\r\n                    /**\r\n                     * Init comment editor.\r\n                     */\r\n                    initBindEditor: function () {\r\n                        var self = this;\r\n                        var isEditorLoaded = false;\r\n                        M.util.js_pending(t.ACTION_EDITOR_INIT);\r\n                        // Interval to init atto editor, there are time when Atto's Javascript slow to init the editor, so we\r\n                        // check interval here to make sure the Atto is init before calling our script.\r\n                        var interval = setInterval(function () {\r\n                            if (self.formSelector.find(t.SELECTOR.ATTO.CONTENT).length !== 0) {\r\n                                self.bindEditorEvent(self.formSelector);\r\n                                isEditorLoaded = true;\r\n                                clearInterval(interval);\r\n                                M.util.js_complete(t.ACTION_EDITOR_INIT);\r\n                            }\r\n                        }, 500);\r\n\r\n                        // If the editor has some content that has been restored\r\n                        // then check the editor content.\r\n                        var editorWaiting = setInterval(function () {\r\n                            if (isEditorLoaded) {\r\n                                self.checkEditorContent(self.formSelector);\r\n                                clearInterval(editorWaiting);\r\n                            }\r\n                        }, 1000);\r\n                    },\r\n\r\n                    /**\r\n                     * Bind events: \"Expand all comments\", \"Collapse all comments\", \"Add Reply\".\r\n                     */\r\n                    bindEvents: function () {\r\n                        var self = this;\r\n                        // Bind event to \"Expand all comments\" button.\r\n                        self.btnExpandAll.click(function (e) {\r\n                            e.preventDefault();\r\n                            M.util.js_pending(t.ACTION_EXPAND_ALL);\r\n                            self.changeWorkingState(true);\r\n                            // Empty the replies section to append new response.\r\n                            self.containerSelector.empty();\r\n                            // Change button from expand to collapse collapse and disabled button since we don't want user to\r\n                            // press the button when javascript is appending item or ajax is working.\r\n                            self.btnExpandAll.hide();\r\n                            self.btnCollapseAll.show();\r\n                            self.loadingIcon.show();\r\n                            self.getComments(t.GET_ALL_VALUE).then(function (response) {\r\n                                // Calculate length to display count.\r\n                                var count = self.countCommentAndReplies(response.data);\r\n                                var total = count.total;\r\n                                self.updateCommentCount(total, response.total);\r\n                                self.renderComment(response.data, true);\r\n                                M.util.js_complete(t.ACTION_EXPAND_ALL);\r\n                                return true;\r\n                            }).fail(function (err) {\r\n                                M.util.js_complete(t.ACTION_EXPAND_ALL);\r\n                                self.showError(err.message);\r\n                                return false;\r\n                            });\r\n                        });\r\n\r\n                        // Bind event to \"Collapse all comments\" button.\r\n                        self.btnCollapseAll.click(function (e) {\r\n                            e.preventDefault();\r\n                            M.util.js_pending(t.ACTION_COLLAPSE_ALL);\r\n                            self.changeWorkingState(true);\r\n                            self.loadingIcon.show();\r\n                            self.btnCollapseAll.hide();\r\n                            self.btnExpandAll.show();\r\n                            self.containerSelector[0].innerHTML = '';\r\n                            self.getComments(self.numberToShow).then(function (response) {\r\n                                // Calculate length to display the post count.\r\n                                var count = self.countCommentAndReplies(response.data);\r\n                                var commentCount = count.commentCount;\r\n                                var deletedComments = count.totalDelete;\r\n                                // Only show expand button and count if comment existed.\r\n                                if (commentCount !== 0 || deletedComments !== 0) {\r\n                                    self.btnExpandAll.show();\r\n                                    self.updateCommentCount(commentCount, response.total);\r\n                                    self.renderComment(response.data, false);\r\n                                } else {\r\n                                    // No comment found hide loading icon.\r\n                                    self.loadingIcon.hide();\r\n                                    self.changeWorkingState(false);\r\n                                    self.updateCommentCount(0, 0);\r\n                                }\r\n                                M.util.js_complete(t.ACTION_COLLAPSE_ALL);\r\n                                return true;\r\n                            }).fail(function (err) {\r\n                                M.util.js_complete(t.ACTION_COLLAPSE_ALL);\r\n                                self.showError(err.message);\r\n                                return false;\r\n                            });\r\n                        });\r\n\r\n                        // Bind event to \"Add Reply\" button (Root comment).\r\n                        self.addComment.click(function (e) {\r\n                            e.preventDefault();\r\n                            M.util.js_pending(t.ACTION_CREATE);\r\n                            self.changeWorkingState(true);\r\n                            self.loadingIcon.show();\r\n                            // Hide error if exists.\r\n                            $(t.SELECTOR.COMMENT_ERROR).addClass('hide');\r\n                            // Hide no comment.\r\n                            $(t.SELECTOR.NO_COMMENT).hide();\r\n                            var rootId = t.ROOT_COMMENT_VALUE;\r\n                            var unique = self.questionId + '_' + rootId;\r\n                            var formSelector = self.formSelector;\r\n                            var formData = self.convertFormToJson(formSelector);\r\n                            // Check message field.\r\n                            if (formData['message[text]'].length === 0) {\r\n                                // Show message, atto won't auto show after second form is appended.\r\n                                var attoWrap = formSelector.find(t.SELECTOR.ATTO_EDITOR_WRAP);\r\n                                if (attoWrap.length !== 0 && !attoWrap.hasClass('error')) {\r\n                                    attoWrap.addClass('error');\r\n                                    attoWrap.prepend('<span class=\"error\" tabindex=\"0\">' + self.string.required + '</span>');\r\n                                }\r\n                                M.util.js_complete(t.ACTION_CREATE);\r\n                                return false;\r\n                            }\r\n                            var params = {\r\n                                replyto: rootId,\r\n                                message: {\r\n                                    text: formData['message[text]'],\r\n                                    format: formData['message[format]'],\r\n                                },\r\n                            };\r\n                            self.createComment(params).then(function (response) {\r\n                                M.util.js_pending(t.ACTION_CLEAR_FORM);\r\n                                // Clear form in setTimeout to prevent require message still shown when reset on Firefox.\r\n                                setTimeout(function () {\r\n                                    // Clear form data.\r\n                                    formSelector.trigger('reset');\r\n                                    // Clear atto editor data.\r\n                                    if (!formSelector.find('#id_editor_question_' + unique + 'editable').is(':visible')) {\r\n                                        // HTML mode. Switch back to normal mode.\r\n                                        $(t.SELECTOR.ATTO_HTML_BUTTON).trigger('click');\r\n                                    }\r\n                                    formSelector.find('#id_editor_question_' + unique + 'editable').empty();\r\n                                    formSelector.find(t.SELECTOR.TEXTAREA).trigger('change');\r\n                                    M.util.js_complete(t.ACTION_CLEAR_FORM);\r\n                                });\r\n                                var data = self.convertForTemplate(response, true);\r\n                                // Disable reply button since content is now empty.\r\n                                formSelector.find(t.SELECTOR.SUBMIT_BUTTON).addClass('disabled');\r\n                                self.appendComment(data, self.elementSelector.find(t.SELECTOR.CONTAINER_REPLIES), false);\r\n                                M.util.js_complete(t.ACTION_CREATE);\r\n                                return true;\r\n                            }).fail(function (e) {\r\n                                self.handleFailWhenCreateComment(e, params);\r\n                                M.util.js_complete(t.ACTION_CREATE);\r\n                            });\r\n                            return true;\r\n                        });\r\n\r\n                        // Bind events filter sort.\r\n                        $(t.SELECTOR.COMMENT_FILTER_ITEM).on('click', function (e) {\r\n                            e.preventDefault();\r\n                            // Check if current state is working, return.\r\n                            if (self.workingState) {\r\n                                return;\r\n                            }\r\n\r\n                            var asc = self.string.sort.asc;\r\n                            var desc = self.string.sort.desc;\r\n\r\n                            var nameSelector = $(this).find(t.SELECTOR.COMMENT_FILTER_NAME);\r\n                            var iconSelector = $(this).find(t.SELECTOR.COMMENT_FILTER_TYPE);\r\n\r\n                            // Get sort type from data-type.\r\n                            var type = $(this).data('type');\r\n                            var orderBy = $(this).attr('data-order');\r\n                            var isCurrent = $(this).hasClass('current');\r\n                            var ascString = $(this).attr('data-asc-string');\r\n                            var descString = $(this).attr('data-desc-string');\r\n\r\n                            // Get current orderBy from data-order. If not current sort, don't change.\r\n                            // Then reverse it to opposite orderBy and call to API.\r\n                            // Example: current is desc, then we should call order by = asc to api.\r\n\r\n                            orderBy = orderBy === 'desc' ? 'asc' : 'desc';\r\n                            // Ok we attach that orderBy to current order by.\r\n                            $(this).attr('data-order', orderBy);\r\n\r\n                            if (!isCurrent) {\r\n                                $(this).addClass('current');\r\n                            }\r\n\r\n                            if (orderBy === 'desc') {\r\n                                nameSelector.attr('title', ascString);\r\n                                nameSelector.attr('alt', ascString);\r\n                                iconSelector.attr('title', desc);\r\n                                iconSelector.attr('alt', desc);\r\n                            } else {\r\n                                nameSelector.attr('title', descString);\r\n                                nameSelector.attr('alt', descString);\r\n                                iconSelector.attr('title', asc);\r\n                                iconSelector.attr('alt', asc);\r\n                            }\r\n\r\n                            // Note: new text is the opposite of current sort type (old type).\r\n\r\n                            // Reset all filter elements to its default.\r\n                            $(t.SELECTOR.COMMENT_FILTER_ITEM).not(this).each(function () {\r\n                                var each = $(this);\r\n                                var eachName = $(this).find(t.SELECTOR.COMMENT_FILTER_NAME);\r\n                                var eachType = $(this).find(t.SELECTOR.COMMENT_FILTER_TYPE);\r\n                                var defaultString = $(this).attr('data-asc-string');\r\n                                each.attr('data-order', 'desc');\r\n                                each.removeClass('filter-asc');\r\n                                each.removeClass('filter-desc');\r\n                                each.removeClass('current');\r\n                                eachName.attr('title', defaultString);\r\n                                eachName.attr('alt', defaultString);\r\n                                eachType.attr('title', asc);\r\n                                eachType.attr('alt', asc);\r\n                            });\r\n\r\n                            if (orderBy === 'desc') {\r\n                                $(this).removeClass('filter-asc');\r\n                                $(this).addClass('filter-desc');\r\n                            } else {\r\n                                $(this).removeClass('filter-desc');\r\n                                $(this).addClass('filter-asc');\r\n                            }\r\n\r\n                            // Build to sort type. Example: date_asc, date_desc.\r\n                            var sortType = type + '_' + orderBy;\r\n                            self.setSort(sortType);\r\n\r\n                            if (self.expand) {\r\n                                self.btnExpandAll.trigger('click');\r\n                            } else {\r\n                                self.btnCollapseAll.trigger('click');\r\n                            }\r\n                        });\r\n                    },\r\n\r\n                    /**\r\n                     * Get comments, numbertoshow = 0 will get all comment + replies.\r\n                     *\r\n                     * @param {Integer} numberToShow\r\n                     * @returns {Promise}\r\n                     */\r\n                    getComments: function (numberToShow) {\r\n                        var self = this;\r\n                        var params = self.getParamsBeforeCallApi({\r\n                            numbertoshow: numberToShow,\r\n                            sort: self.sortFeature\r\n                        });\r\n                        var promise = ajax.call([{\r\n                            methodname: t.ACTION_GET_ALL,\r\n                            args: params\r\n                        }]);\r\n                        return promise[0];\r\n                    },\r\n\r\n                    /**\r\n                     * Always map questionId and cmId to request before send.\r\n                     *\r\n                     * @param {Object} params\r\n                     * @returns {Object}\r\n                     */\r\n                    getParamsBeforeCallApi: function (params) {\r\n                        var self = this;\r\n                        params.questionid = self.questionId;\r\n                        params.cmid = self.cmId;\r\n                        return params;\r\n                    },\r\n\r\n                    /**\r\n                     * Show error which call showDialog().\r\n                     *\r\n                     * @param {String} message\r\n                     */\r\n                    showError: function (message) {\r\n                        var self = this;\r\n                        M.util.js_pending(t.ACTION_SHOW_ERROR);\r\n                        // Get error string for title.\r\n                        $.when(self.string.error).done(function (string) {\r\n                            self.showDialog(string, message);\r\n                            self.changeWorkingState(false);\r\n                            M.util.js_complete(t.ACTION_SHOW_ERROR);\r\n                        });\r\n                    },\r\n\r\n                    /**\r\n                     * Show the dialog with custom title and body.\r\n                     *\r\n                     * @param {String} title\r\n                     * @param {String} body\r\n                     */\r\n                    showDialog: function (title, body) {\r\n                        var self = this;\r\n                        var dialogue = self.dialogue;\r\n                        if (dialogue) {\r\n                            // This dialog is existed, only change title and body and then display.\r\n                            dialogue.title.html(title);\r\n                            dialogue.body.html(body);\r\n                            dialogue.show();\r\n                            return;\r\n                        }\r\n                        ModalFactory.create({\r\n                            type: ModalFactory.types.CANCEL,\r\n                            title: title,\r\n                            body: body\r\n                        }).done(function (modal) {\r\n                            dialogue = modal;\r\n                            // Display the dialogue.\r\n                            dialogue.show();\r\n                            dialogue.getRoot().on(ModalEvents.hidden, {}, function () {\r\n                                location.reload();\r\n                            });\r\n                        });\r\n                    },\r\n\r\n                    /**\r\n                     * Update the comments count on UI, of second parameter is not set then use the last value.\r\n                     *\r\n                     * @param {Integer|NULL} current\r\n                     * @param {Integer|NULL} total\r\n                     */\r\n                    updateCommentCount: function (current, total) {\r\n                        M.util.js_pending(t.ACTION_UPDATE_COMMENT_COUNT);\r\n                        var self = this;\r\n\r\n                        // If total parameter is not set, use the old value.\r\n                        if (total === -1) {\r\n                            total = self.lastTotal;\r\n                        } else {\r\n                            self.lastTotal = total;\r\n                        }\r\n\r\n                        // If current parameter is not set, use the old value.\r\n                        if (current === -1) {\r\n                            current = self.lastCurrentCount;\r\n                        } else {\r\n                            self.lastCurrentCount = current;\r\n                        }\r\n\r\n                        // Get the postof local string and display.\r\n                        var s = str.get_string('current_of_total', 'studentquiz', {\r\n                            current: current,\r\n                            total: total\r\n                        });\r\n\r\n                        var noCommentSelector = $(t.SELECTOR.NO_COMMENT);\r\n                        var filter = $(t.SELECTOR.COMMENT_FILTER);\r\n                        var emptyReplies = self.checkEmptyElement($(t.SELECTOR.CONTAINER_REPLIES));\r\n                        // Note: Admin will see deleted comments. Make sure replies container is empty.\r\n                        if (self.lastCurrentCount === 0 && emptyReplies && self.isNoComment) {\r\n                            $(t.SELECTOR.CONTAINER_REPLIES).hide();\r\n                            filter.hide();\r\n                            noCommentSelector.show();\r\n                        } else {\r\n                            $(t.SELECTOR.CONTAINER_REPLIES).show();\r\n                            noCommentSelector.hide();\r\n                            filter.show();\r\n                        }\r\n\r\n                        $.when(s).done(function (text) {\r\n                            self.elementSelector.find(t.SELECTOR.COMMENT_COUNT).text(text);\r\n                            M.util.js_complete(t.ACTION_UPDATE_COMMENT_COUNT);\r\n                        });\r\n                    },\r\n\r\n                    /**\r\n                     * Request template then append it into the page.\r\n                     *\r\n                     * @param {Array} comments\r\n                     * @param {Boolean} expanded\r\n                     * @returns {Boolean}\r\n                     */\r\n                    renderComment: function (comments, expanded) {\r\n                        var self = this;\r\n                        M.util.js_pending(t.ACTION_RENDER_COMMENT);\r\n                        comments = self.convertForTemplate(comments, expanded);\r\n                        Templates.render(t.TEMPLATE_COMMENTS, {\r\n                            comments: comments\r\n                        }).done(function (html) {\r\n                            // We render a lot of data, pure js here.\r\n                            self.containerSelector[0].innerHTML = html;\r\n                            // Turn off loading to show raw html first, then we bind events.\r\n                            self.loadingIcon.hide();\r\n                            // Loop to bind event.\r\n                            for (var i = 0; i < comments.length; i++) {\r\n                                self.bindCommentEvent(comments[i]);\r\n                            }\r\n                            self.changeWorkingState(false);\r\n                            M.util.js_complete(t.ACTION_RENDER_COMMENT);\r\n                        });\r\n                    },\r\n\r\n                    /**\r\n                     * Bind event to comment: report, reply, expand, collapse button.\r\n                     *\r\n                     * @param {Object} data\r\n                     */\r\n                    bindCommentEvent: function (data) {\r\n                        var self = this;\r\n                        // Loop comments and replies to get id and bind event for button inside it.\r\n                        var el = self.containerSelector.find(t.SELECTOR.COMMENT_ID + data.id);\r\n                        var i = 0;\r\n                        if (data.root && data.hasOwnProperty('replies')) {\r\n                            for (i; i < data.replies.length; i++) {\r\n                                var reply = data.replies[i];\r\n                                if (!reply.hasOwnProperty('expand')) {\r\n                                    reply.expand = true;\r\n                                }\r\n                                if (!reply.hasOwnProperty('root')) {\r\n                                    reply.root = false;\r\n                                }\r\n                                self.bindReplyEvent(reply, el);\r\n                            }\r\n                        }\r\n                        el.find(t.SELECTOR.BTN_DELETE).click(function (e) {\r\n                            self.bindDeleteEvent(data);\r\n                            e.preventDefault();\r\n                        });\r\n                        el.find(t.SELECTOR.BTN_REPLY).click(function (e) {\r\n                            e.preventDefault();\r\n                            self.getFragmentFormReplyEvent(data);\r\n                        });\r\n                        el.find(t.SELECTOR.EXPAND_LINK).click(function (e) {\r\n                            e.preventDefault();\r\n                            self.bindExpandEvent(data);\r\n                        });\r\n                        el.find(t.SELECTOR.COLLAPSE_LINK).click(function (e) {\r\n                            e.preventDefault();\r\n                            self.bindCollapseEvent(data);\r\n                        });\r\n                        el.find(t.SELECTOR.BTN_REPORT).click(function (e) {\r\n                            e.preventDefault();\r\n                            window.location = $(this).data('href');\r\n                        });\r\n                        el.find(t.SELECTOR.BTN_EDIT).click(function (e) {\r\n                            e.preventDefault();\r\n                            self.getFragmentEditFormEvent(data);\r\n                        });\r\n                    },\r\n\r\n                    /**\r\n                     * Bind event to reply's report and edit button.\r\n                     *\r\n                     * @param {Object} reply\r\n                     * @param {jQuery} el\r\n                     */\r\n                    bindReplyEvent: function (reply, el) {\r\n                        var self = this;\r\n                        var replySelector = el.find(t.SELECTOR.COMMENT_ID + reply.id);\r\n                        replySelector.find(t.SELECTOR.BTN_DELETE_REPLY).click(function (e) {\r\n                            self.bindDeleteEvent(reply);\r\n                            e.preventDefault();\r\n                        });\r\n                        replySelector.find(t.SELECTOR.BTN_REPORT).click(function (e) {\r\n                            e.preventDefault();\r\n                            window.location = $(this).data('href');\r\n                        });\r\n                        replySelector.find(t.SELECTOR.BTN_EDIT_REPLY).click(function (e) {\r\n                            e.preventDefault();\r\n                            self.getFragmentEditFormEvent(reply);\r\n                        });\r\n                    },\r\n\r\n                    /**\r\n                     * This function will disable/hide or enable/show when called depending on the working parameter.\r\n                     * Should call this function when we are going to perform the heavy operation like calling web service,\r\n                     * get render template, its will disabled button to prevent user from perform another action when page\r\n                     * is loading.\r\n                     * \"working\" is boolean parameter \"true\" will disable/hide \"false\" will enable/show.\r\n                     *\r\n                     * @param {Boolean} boolean\r\n                     * @param {null|jQuery} elementToHide\r\n                     */\r\n                    changeWorkingState: function (boolean, elementToHide = null) {\r\n                        var visibility = boolean ? 'hidden' : 'visible';\r\n                        var self = this;\r\n                        self.workingState = boolean;\r\n                        self.btnExpandAll.prop('disabled', boolean);\r\n                        self.btnCollapseAll.prop('disabled', boolean);\r\n                        self.elementSelector.find(t.SELECTOR.BTN_REPLY).prop('disabled', boolean);\r\n                        self.elementSelector.find(t.SELECTOR.BTN_DELETE).prop('disabled', boolean);\r\n                        self.elementSelector.find(t.SELECTOR.BTN_DELETE_REPLY).prop('disabled', boolean);\r\n                        self.elementSelector.find(t.SELECTOR.BTN_REPORT).prop('disabled', boolean);\r\n                        self.elementSelector.find(t.SELECTOR.EXPAND_LINK).css('visibility', visibility);\r\n                        self.elementSelector.find(t.SELECTOR.COLLAPSE_LINK).css('visibility', visibility);\r\n                        self.elementSelector.find(t.SELECTOR.BTN_EDIT).prop('disabled', boolean);\r\n                        self.elementSelector.find(t.SELECTOR.BTN_EDIT_REPLY).prop('disabled', boolean);\r\n                        if (self.deleteDialog) {\r\n                            self.deleteDialog.getFooter().find('button[data-action=\"yes\"]').prop('disabled', boolean);\r\n                        }\r\n                        if (boolean) {\r\n                            self.addComment.prop('disabled', boolean);\r\n                            if (elementToHide !== null && elementToHide instanceof $) {\r\n                                elementToHide.hide();\r\n                            }\r\n                        } else {\r\n                            if (self.lastFocusElement) {\r\n                                self.lastFocusElement.focus();\r\n                                self.lastFocusElement = null;\r\n                            }\r\n                            self.elementSelector.find(t.SELECTOR.POST_FOOTER).show();\r\n                        }\r\n                    },\r\n\r\n                    /**\r\n                     * Count comments, deleted comments and replies.\r\n                     *\r\n                     * @param {*} data\r\n                     * @returns {{\r\n                     * deleteReplyCount: number,\r\n                     * total: number,\r\n                     * replyCount: number,\r\n                     * totalDelete: number,\r\n                     * deleteCommentCount: number,\r\n                     * commentCount: number\r\n                     * }}\r\n                     */\r\n                    countCommentAndReplies: function (data) {\r\n                        var commentCount = 0;\r\n                        var deleteCommentCount = 0;\r\n                        var replyCount = 0;\r\n                        var deleteReplyCount = 0;\r\n\r\n                        if (data.constructor !== Array) {\r\n                            data = [data];\r\n                        }\r\n\r\n                        for (var i = 0; i < data.length; i++) {\r\n                            var item = data[i];\r\n                            if (item.deletedtime == 0) {\r\n                                commentCount++;\r\n                            } else {\r\n                                deleteCommentCount++;\r\n                            }\r\n                            for (var j = 0; j < item.replies.length; j++) {\r\n                                var reply = item.replies[j];\r\n                                if (reply.deletedtime == 0) {\r\n                                    replyCount++;\r\n                                } else {\r\n                                    deleteReplyCount++;\r\n                                }\r\n                            }\r\n                        }\r\n                        return {\r\n                            total: commentCount + replyCount,\r\n                            totalDelete: deleteCommentCount + deleteReplyCount,\r\n                            commentCount: commentCount,\r\n                            deleteCommentCount: deleteCommentCount,\r\n                            replyCount: replyCount,\r\n                            deleteReplyCount: deleteReplyCount\r\n                        };\r\n                    },\r\n\r\n                    /**\r\n                     * Call web service to info of comment and its replies.\r\n                     *\r\n                     * @param {Integer} id\r\n                     * @returns {Promise}\r\n                     */\r\n                    expandComment: function (id) {\r\n                        var self = this;\r\n                        var params = self.getParamsBeforeCallApi({\r\n                            commentid: id\r\n                        });\r\n                        var promise = ajax.call([{\r\n                            methodname: t.ACTION_EXPAND,\r\n                            args: params\r\n                        }]);\r\n                        return promise[0];\r\n                    },\r\n\r\n                    /**\r\n                     * Expand event handler.\r\n                     *\r\n                     * @param {Object} item\r\n                     */\r\n                    bindExpandEvent: function (item) {\r\n                        var self = this;\r\n                        var itemSelector = self.elementSelector.find(t.SELECTOR.COMMENT_ID + item.id);\r\n                        var key = t.ACTION_EXPAND;\r\n                        M.util.js_pending(key);\r\n                        self.changeWorkingState(true);\r\n                        // Clone loading icon selector then append into replies section.\r\n                        var loadingIcon = self.loadingIcon.clone().show();\r\n                        itemSelector.find(t.SELECTOR.COMMENT_REPLIES_CONTAINER).append(loadingIcon);\r\n                        $(self).hide();\r\n                        // Call expand post web service to get replies.\r\n                        self.expandComment(item.id).then(function (response) {\r\n                            var convertedItem = self.convertForTemplate(response, true);\r\n\r\n                            // Count current reply displayed, because user can reply to this comment then press expanded.\r\n                            var currentDisplayComment = itemSelector.find(t.SELECTOR.COMMENT_REPLIES_CONTAINER_TO_ITEM).length;\r\n\r\n                            // Update count, handle the case when another user add post then current user expand.\r\n                            var total = self.countCommentAndReplies(convertedItem).replyCount;\r\n                            var newCount = self.lastCurrentCount + total - currentDisplayComment;\r\n                            var newTotalCount = self.lastTotal + (convertedItem.numberofreply - item.numberofreply);\r\n\r\n                            if (item.deleted && !convertedItem.deleted) {\r\n                                newCount++;\r\n                                newTotalCount++;\r\n                            }\r\n\r\n                            // Normal comment, then deleted by someone else.\r\n                            if (!item.deleted && convertedItem.deleted) {\r\n                                newCount--;\r\n                                newTotalCount--;\r\n                            }\r\n\r\n                            // If current show == total mean that all items is shown.\r\n                            if (newCount === newTotalCount) {\r\n                                self.btnExpandAll.hide();\r\n                                self.btnCollapseAll.show();\r\n                            }\r\n\r\n                            self.updateCommentCount(newCount, newTotalCount);\r\n\r\n                            return Templates.render(t.TEMPLATE_COMMENT, convertedItem).done(function (html) {\r\n                                var el = $(html);\r\n                                itemSelector.replaceWith(el);\r\n                                self.lastFocusElement = el.find(t.SELECTOR.COLLAPSE_LINK);\r\n                                self.bindCommentEvent(response);\r\n                                self.changeWorkingState(false);\r\n                                M.util.js_complete(key);\r\n                                return true;\r\n                            });\r\n                        }).fail(function (e) {\r\n                            M.util.js_complete(key);\r\n                            self.showError(e.message);\r\n                        });\r\n                    },\r\n\r\n                    /**\r\n                     * Collapse event handler.\r\n                     *\r\n                     * @param {Object} item\r\n                     */\r\n                    bindCollapseEvent: function (item) {\r\n                        var self = this;\r\n\r\n                        var el = self.elementSelector.find(t.SELECTOR.COMMENT_ID + item.id);\r\n\r\n                        // Minus the comment currently show, exclude the deleted comment, update main count.\r\n                        // Using DOM to count the reply exclude the deleted, when user delete the reply belong to this comment,\r\n                        // current comment object don't know that, so we using DOM in this case.\r\n                        var commentCount = el.find(t.SELECTOR.COMMENT_REPLIES_TEXT).length;\r\n                        self.updateCommentCount(self.lastCurrentCount - commentCount, -1);\r\n                        // Assign back to comment object in case user then collapse the comment.\r\n                        item.numberofreply = commentCount;\r\n\r\n                        // Remove reply for this comment.\r\n                        el.find(t.SELECTOR.COMMENT_REPLIES_CONTAINER).empty();\r\n\r\n                        // Replace comment content with short content.\r\n                        if (item.deleted) {\r\n                            el.find('.studentquiz-comment-delete-content').html(item.shortcontent);\r\n                        } else {\r\n                            el.find(t.SELECTOR.COMMENT_TEXT).html(item.shortcontent);\r\n                        }\r\n\r\n                        // Hide collapse and show expand icon.\r\n                        el.find(t.SELECTOR.COLLAPSE_LINK).hide();\r\n                        el.find(t.SELECTOR.EXPAND_LINK).show().focus();\r\n\r\n                        // Update state.\r\n                        item.expanded = false;\r\n                    },\r\n\r\n                    /**\r\n                     * Convert for template render.\r\n                     *\r\n                     * @param {*} data\r\n                     * @param {Boolean} expanded\r\n                     * @returns {*}\r\n                     */\r\n                    convertForTemplate: function (data, expanded) {\r\n                        var self = this;\r\n                        var single = false;\r\n                        if (data.constructor !== Array) {\r\n                            data = [data];\r\n                            single = true;\r\n                        }\r\n                        for (var i = 0; i < data.length; i++) {\r\n                            var item = data[i];\r\n                            item.expanded = expanded;\r\n                            item.canviewdeleted = self.canViewDeleted;\r\n                            if (!item.hasOwnProperty('replies')) {\r\n                                item.replies = [];\r\n                            }\r\n                            self.setHasComment(item.hascomment);\r\n                            item.highlight = item.id === self.highlight;\r\n                            if (self.referer && item.reportlink) {\r\n                                item.reportlink = self.buildRefererReportLink(item.reportlink, item.id);\r\n                            }\r\n                            // Only root comment has replies.\r\n                            if (item.root) {\r\n                                for (var j = 0; j < item.replies.length; j++) {\r\n                                    var reply = item.replies[j];\r\n                                    reply.expanded = true;\r\n                                    reply.canviewdeleted = self.canViewDeleted;\r\n                                    if (!reply.hasOwnProperty('replies')) {\r\n                                        reply.replies = [];\r\n                                    }\r\n                                    reply.highlight = reply.id === self.highlight;\r\n                                    if (self.referer && reply.reportlink) {\r\n                                        reply.reportlink = self.buildRefererReportLink(reply.reportlink, reply.id);\r\n                                    }\r\n                                }\r\n                            }\r\n                            item.allowselfcommentrating = self.allowSelfCommentRating;\r\n                        }\r\n                        return single ? data[0] : data;\r\n                    },\r\n\r\n                    /**\r\n                     * Convert form data to Json require for web service.\r\n                     * Note: attempt.php had form already, we cannot have a form inside a form.\r\n                     *\r\n                     * @param {jQuery} form\r\n                     * @returns {Object}\r\n                     */\r\n                    convertFormToJson: function (form) {\r\n                        var data = {};\r\n                        form.find(\":input\").each(function () {\r\n                            var type = $(this).prop(\"type\");\r\n                            var name = $(this).attr('name');\r\n                            // Checked radios/checkboxes.\r\n                            if ((type === \"checkbox\" || type === \"radio\") && this.checked\r\n                                || (type !== \"button\" && type !== \"submit\")) {\r\n                                data[name] = $(this).val();\r\n                            }\r\n                        });\r\n                        return data;\r\n                    },\r\n\r\n                    /**\r\n                     * Call web services to create comment.\r\n                     *\r\n                     * @param {Object} data\r\n                     * @returns {Promise}\r\n                     */\r\n                    createComment: function (data) {\r\n                        var self = this;\r\n                        data = self.getParamsBeforeCallApi(data);\r\n                        var promise = ajax.call([{\r\n                            methodname: t.ACTION_CREATE,\r\n                            args: data\r\n                        }]);\r\n                        return promise[0];\r\n                    },\r\n\r\n                    /**\r\n                     * Append comment to the DOM, and call another function to bind the event into it.\r\n                     *\r\n                     * @param {Object} item\r\n                     * @param {jQuery} target\r\n                     * @param {Boolean} isReply\r\n                     */\r\n                    appendComment: function (item, target, isReply) {\r\n                        var self = this;\r\n                        M.util.js_pending(t.ACTION_APPEND_COMMENT);\r\n                        Templates.render(t.TEMPLATE_COMMENT, item).done(function (html) {\r\n                            var el = $(html);\r\n                            target.append(el);\r\n                            if (!self.lastCurrentCount) {\r\n                                // This is the first reply.\r\n                                $(t.SELECTOR.COMMENT_FILTER).removeClass(t.SELECTOR.COMMENT_FILTER_HIDE);\r\n                                self.updateCommentCount(1, 1);\r\n                                self.btnExpandAll.prop('disabled', true);\r\n                                self.btnExpandAll.hide();\r\n                                self.btnCollapseAll.prop('disabled', false);\r\n                                self.btnCollapseAll.show();\r\n                                self.expand = true;\r\n                                self.isNoComment = false;\r\n                            } else {\r\n                                self.updateCommentCount(self.lastCurrentCount + 1, self.lastTotal + 1);\r\n                            }\r\n                            if (isReply) {\r\n                                self.bindReplyEvent(item, el.parent());\r\n                            } else {\r\n                                self.bindCommentEvent(item);\r\n                            }\r\n                            self.loadingIcon.hide();\r\n                            self.changeWorkingState(false);\r\n                            M.util.js_complete(t.ACTION_APPEND_COMMENT);\r\n                        });\r\n                    },\r\n\r\n                    /*\r\n                    * Call web services to get the fragment form, append to the DOM then bind event.\r\n                    * */\r\n                    loadFragmentForm: function (fragmentForm, item) {\r\n                        var self = this;\r\n                        M.util.js_pending(t.ACTION_LOAD_FRAGMENT_FORM);\r\n                        var params = self.getParamsBeforeCallApi({\r\n                            replyto: item.id,\r\n                            cancelbutton: true,\r\n                            forcecommenting: self.forceCommenting\r\n                        });\r\n                        // Clear error message on the main form to prevent Atto editor from focusing to old message.\r\n                        var attoWrap = self.formSelector.find(t.SELECTOR.ATTO_EDITOR_WRAP);\r\n                        if (attoWrap.length !== 0 && attoWrap.hasClass('error')) {\r\n                            attoWrap.removeClass('error');\r\n                            attoWrap.find('#id_error_message_5btext_5d').remove();\r\n                        }\r\n                        fragment.loadFragment(\r\n                            'mod_studentquiz',\r\n                            t.FRAGMENT_FORM_CALLBACK,\r\n                            self.contextId,\r\n                            params\r\n                        ).done(function (html, js) {\r\n                            Templates.replaceNodeContents(fragmentForm, html, js);\r\n                            // Focus form reply.\r\n                            var textFragmentFormId = '#id_editor_question_' + self.questionId + '_' + item.id + 'editable';\r\n                            fragmentForm.find(textFragmentFormId).focus();\r\n                            self.bindFragmentFormEvent(fragmentForm, item);\r\n                            M.util.js_complete(t.ACTION_LOAD_FRAGMENT_FORM);\r\n                        });\r\n                    },\r\n\r\n                    /*\r\n                    * Bind fragment form action button event like \"Reply\" or \"Save changes\".\r\n                    * */\r\n                    bindFragmentFormEvent: function (fragmentForm, item) {\r\n                        var self = this;\r\n                        var formFragmentSelector = fragmentForm.find(t.SELECTOR.COMMENT_AREA_FORM);\r\n                        fragmentForm.find(t.SELECTOR.SUBMIT_BUTTON).click(function (e) {\r\n                            e.preventDefault();\r\n                            self.changeWorkingState(true);\r\n                            var data = self.convertFormToJson(formFragmentSelector);\r\n                            // Check message field.\r\n                            if (data['message[text]'].length === 0) {\r\n                                return true; // Return true to trigger form validation and show error messages.\r\n                            }\r\n                            var clone = self.loadingIcon.clone().show();\r\n                            clone.appendTo(fragmentForm);\r\n                            formFragmentSelector.hide();\r\n                            self.createReplyComment(fragmentForm, item, formFragmentSelector, data);\r\n                            return true;\r\n                        });\r\n                        self.fragmentFormCancelEvent(formFragmentSelector, false);\r\n                        self.bindEditorEvent(fragmentForm);\r\n                    },\r\n\r\n                    /*\r\n                    * Call web services to create reply, update parent comment count, remove the fragment form.\r\n                    * */\r\n                    createReplyComment: function (replyContainer, item, formSelector, formData) {\r\n                        var self = this;\r\n                        var params = {\r\n                            replyto: item.id,\r\n                            message: {\r\n                                text: formData['message[text]'],\r\n                                format: formData['message[format]'],\r\n                            }\r\n                        };\r\n                        M.util.js_pending(t.ACTION_CREATE_REPLY);\r\n                        self.createComment(params).then(function (response) {\r\n                            // Hide error if exists.\r\n                            $(t.SELECTOR.COMMENT_ERROR).addClass('hide');\r\n                            var el = self.elementSelector.find(t.SELECTOR.COMMENT_ID + item.id);\r\n                            var repliesEl = el.find(t.SELECTOR.COMMENT_REPLIES_CONTAINER);\r\n\r\n                            // There are case when user delete the reply then add reply then the numberofreply property is\r\n                            // not correct because this comment object does not know the child object is deleted, so we update\r\n                            // comment count using DOM.\r\n                            item.numberofreply++;\r\n\r\n                            var numReply = parseInt(el.find(t.SELECTOR.COMMENT_COUNT_NUMBER).text()) + 1;\r\n\r\n                            // Update total count.\r\n                            el.find(t.SELECTOR.COMMENT_COUNT_NUMBER).text(numReply);\r\n                            el.find(t.SELECTOR.COMMENT_COUNT_TEXT).html(\r\n                                numReply === 1 ? self.string.reply : self.string.replies\r\n                            );\r\n\r\n                            replyContainer.empty();\r\n                            var data = self.convertForTemplate(response, true);\r\n                            self.appendComment(data, repliesEl, true);\r\n                            M.util.js_complete(t.ACTION_CREATE_REPLY);\r\n                            return true;\r\n                        }).fail(function (e) {\r\n                            self.handleFailWhenCreateComment(e, params);\r\n                            M.util.js_complete(t.ACTION_CREATE_REPLY);\r\n                        });\r\n                    },\r\n\r\n                    handleFailWhenCreateComment: function (e, params) {\r\n                        var self = this;\r\n                        self.showError(e.message);\r\n                        // Remove the fragment form container.\r\n                        var fragmentFormSelector = t.SELECTOR.COMMENT_ID + params.replyto + ' ' + t.SELECTOR.FRAGMENT_FORM;\r\n                        self.elementSelector.find(fragmentFormSelector).empty();\r\n                    },\r\n\r\n                    /*\r\n                    * Begin to load the fragment form for reply.\r\n                    * */\r\n                    getFragmentFormReplyEvent: function (item) {\r\n                        var self = this;\r\n                        var el = self.elementSelector.find(t.SELECTOR.COMMENT_ID + item.id);\r\n                        var fragmentForm = el.find(t.SELECTOR.FRAGMENT_FORM).first();\r\n                        var postFooter = el.find(t.SELECTOR.POST_FOOTER).first();\r\n                        var clone = self.loadingIcon.clone().show();\r\n                        fragmentForm.append(clone);\r\n                        fragmentForm.removeClass('edit');\r\n                        fragmentForm.addClass('reply');\r\n                        self.loadFragmentForm(fragmentForm, item);\r\n                        self.changeWorkingState(true, postFooter);\r\n                    },\r\n\r\n                    /**\r\n                     * Bind fragment form cancel button event.\r\n                     *\r\n                     * @param {jQuery} formSelector\r\n                     * @param {Boolean} isEdit\r\n                     */\r\n                    fragmentFormCancelEvent: function (formSelector, isEdit) {\r\n                        var self = this;\r\n                        formSelector.find('#id_cancel').click(function (e) {\r\n                            e.preventDefault();\r\n                            var commentSelector = formSelector.closest(t.SELECTOR.COMMENT_ITEM);\r\n                            if (isEdit) {\r\n                                self.lastFocusElement = commentSelector.find(t.SELECTOR.BTN_EDIT);\r\n                            } else {\r\n                                self.lastFocusElement = commentSelector.find(t.SELECTOR.BTN_REPLY);\r\n                            }\r\n                            self.changeWorkingState(false);\r\n                            formSelector.parent().empty();\r\n                        });\r\n                    },\r\n\r\n                    /**\r\n                     * Bind comment delete event.\r\n                     *\r\n                     * @param {Object} data\r\n                     */\r\n                    bindDeleteEvent: function (data) {\r\n                        var self = this;\r\n                        self.deleteTarget = data;\r\n                        if (self.deleteDialog) {\r\n                            // Use the rendered modal.\r\n                            self.deleteDialog.show();\r\n                        } else {\r\n                            // Disabled button to prevent user from double click on button while loading for template\r\n                            // for the first time.\r\n                            self.changeWorkingState(true);\r\n                            ModalFactory.create({\r\n                                type: ModalFactory.types.DEFAULT,\r\n                                title: self.string.deletecomment,\r\n                                body: self.string.confirmdeletecomment,\r\n                                footer: '<button class=\"btn btn-primary\" type=\"button\" data-action=\"yes\" title=\"' +\r\n                                    self.string.deletecomment + '\">' + self.string.deletetext + '</button>' +\r\n                                    '<button class=\"btn btn-secondary\" type=\"button\" data-action=\"no\" title=\"' +\r\n                                    self.string.cancel + '\">' +\r\n                                    self.string.cancel + '</button>'\r\n                            }).done(function (modal) {\r\n                                // Save modal for later.\r\n                                self.deleteDialog = modal;\r\n\r\n                                // Bind event for cancel button.\r\n                                modal.getFooter().find('button[data-action=\"no\"]').click(function (e) {\r\n                                    e.preventDefault();\r\n                                    modal.hide();\r\n                                });\r\n\r\n                                // Bind event for delete button.\r\n                                modal.getFooter().find('button[data-action=\"yes\"]').click(function (e) {\r\n                                    e.preventDefault();\r\n                                    M.util.js_pending(t.ACTION_DELETE);\r\n                                    self.changeWorkingState(true);\r\n                                    // Call web service to delete post.\r\n                                    self.deleteComment(self.deleteTarget.id).then(function (response) {\r\n                                        if (!response.success) {\r\n                                            self.showError(response.message);\r\n                                            return true;\r\n                                        }\r\n\r\n                                        var convertedCommentData = self.convertForTemplate(response.data,\r\n                                            self.deleteTarget.expanded);\r\n\r\n                                        // Delete success, begin to call template and render the page again.\r\n                                        var commentSelector = $(t.SELECTOR.COMMENT_ID + convertedCommentData.id);\r\n\r\n                                        var deletedComments = 1;\r\n\r\n                                        // Update global comment count.\r\n                                        self.updateCommentCount(\r\n                                            self.lastCurrentCount - deletedComments,\r\n                                            self.lastTotal - deletedComments\r\n                                        );\r\n\r\n                                        // Reply will always be expanded.\r\n                                        // Root comment deleted all replies => collapsed.\r\n                                        if (!convertedCommentData.root) {\r\n                                            convertedCommentData.expanded = true;\r\n                                        }\r\n\r\n                                        // Call template to render.\r\n                                        Templates.render(t.TEMPLATE_COMMENT, convertedCommentData).done(function (html) {\r\n                                            var el = $(html);\r\n\r\n                                            // Update the parent comment count if we delete reply before replace.\r\n                                            if (!convertedCommentData.root) {\r\n                                                var parentSelector = commentSelector.parent();\r\n                                                var parentCountSelector = parentSelector.closest(t.SELECTOR.COMMENT_ITEM)\r\n                                                    .find(t.SELECTOR.TOTAL_REPLY);\r\n                                                var countSelector = parentCountSelector.find(t.SELECTOR.COMMENT_COUNT_NUMBER);\r\n                                                var newCount = parseInt(countSelector.text()) - 1;\r\n                                                parentCountSelector.find(t.SELECTOR.COMMENT_COUNT_NUMBER).text(newCount);\r\n                                                parentCountSelector.find(t.SELECTOR.COMMENT_COUNT_TEXT).html(\r\n                                                    newCount === 1 ? self.string.reply : self.string.replies\r\n                                                );\r\n                                            }\r\n\r\n                                            // Clone replies and append because the replies will be replaced by template.\r\n                                            var oldReplies = commentSelector.find(t.SELECTOR.COMMENT_REPLIES_CONTAINER)\r\n                                                .clone(true);\r\n                                            commentSelector.replaceWith(el);\r\n                                            el.find(t.SELECTOR.COMMENT_REPLIES_CONTAINER).replaceWith(oldReplies);\r\n                                            if (self.deleteTarget.root) {\r\n                                                self.bindCommentEvent(response.data);\r\n                                            } else {\r\n                                                self.bindReplyEvent(response.data, el.parent());\r\n                                            }\r\n                                            self.changeWorkingState(false);\r\n                                            M.util.js_complete(t.ACTION_DELETE);\r\n                                        });\r\n                                        modal.hide();\r\n                                        return true;\r\n                                    }).fail(function (err) {\r\n                                        self.showError(err.message);\r\n                                        return false;\r\n                                    });\r\n                                });\r\n\r\n                                // Focus back to delete button when user hide modal.\r\n                                modal.getRoot().on(ModalEvents.hidden, function () {\r\n                                    var el = $(t.SELECTOR.COMMENT_ID + self.deleteTarget.id);\r\n                                    // Focus on different element base on comment or reply.\r\n                                    if (self.deleteTarget.root) {\r\n                                        el.find(t.SELECTOR.BTN_DELETE).first().focus();\r\n                                    } else {\r\n                                        el.find(t.SELECTOR.BTN_DELETE_REPLY).first().focus();\r\n                                    }\r\n                                });\r\n\r\n                                // Enable button when modal is shown.\r\n                                modal.getRoot().on(ModalEvents.shown, function () {\r\n                                    self.changeWorkingState(false);\r\n                                });\r\n\r\n                                // Display the dialogue.\r\n                                modal.show();\r\n\r\n                                self.changeWorkingState(false);\r\n                            });\r\n                        }\r\n                    },\r\n\r\n                    /**\r\n                     * Delete comment API.\r\n                     *\r\n                     * @param {Integer} id\r\n                     * @returns {Promise}\r\n                     */\r\n                    deleteComment: function (id) {\r\n                        var self = this;\r\n                        var params = self.getParamsBeforeCallApi({\r\n                            commentid: id\r\n                        });\r\n                        var promise = ajax.call([{\r\n                            methodname: t.ACTION_DELETE,\r\n                            args: params\r\n                        }]);\r\n                        return promise[0];\r\n                    },\r\n\r\n                    /**\r\n                     * Bind Atto event.\r\n                     *\r\n                     * @param {jQuery} formSelector\r\n                     */\r\n                    bindEditorEvent: function (formSelector) {\r\n                        var self = this;\r\n                        M.util.js_pending('init_editor');\r\n\r\n                        self.triggerAttoNoContent(formSelector);\r\n\r\n                        formSelector.find(t.SELECTOR.ATTO.TOOLBAR).fadeIn();\r\n                        var textareaSelector = formSelector.find(t.SELECTOR.TEXTAREA);\r\n                        var attoEditableId = textareaSelector.attr('id') + 'editable';\r\n                        var attoEditable = document.getElementById(attoEditableId);\r\n                        var observation = new MutationObserver(function (mutationsList) {\r\n                            mutationsList.forEach(function (mutation) {\r\n                                if (mutation.type === 'attributes' &&\r\n                                    (mutation.attributeName === 'style' || mutation.attributeName === 'hidden')) {\r\n                                    self.checkEditorContent(formSelector);\r\n                                }\r\n                            });\r\n                        });\r\n                        observation.observe(attoEditable, { attributes: true, childList: true, subtree: true });\r\n                        textareaSelector.change(function () {\r\n                            self.checkEditorContent(formSelector);\r\n                        });\r\n                        M.util.js_complete('init_editor');\r\n\r\n                        // Check interval for 5s in case draft content show up.\r\n                        var interval = setInterval(function () {\r\n                            formSelector.find('textarea[id^=\"id_message\"]').trigger('change');\r\n                        }, 350);\r\n\r\n                        setTimeout(function () {\r\n                            clearInterval(interval);\r\n                        }, 5000);\r\n                    },\r\n\r\n                    /**\r\n                     * Check if element is empty.\r\n                     *\r\n                     * @param {jQuery} el - Element.\r\n                     * @returns {boolean}\r\n                     */\r\n                    checkEmptyElement: function (el) {\r\n                        return el.children().length === 0;\r\n                    },\r\n\r\n                    /**\r\n                     * Set user has commented.\r\n                     *\r\n                     * @param {integer} value\r\n                     */\r\n                    setHasComment: function (value) {\r\n                        var self = this;\r\n                        var container = $(t.SELECTOR.CONTAINER);\r\n                        var hasCommentClass = t.HAS_COMMENT_CLASS;\r\n                        if (!self.forceCommenting) {\r\n                            self.hasComment = true;\r\n                            container.addClass(hasCommentClass);\r\n                        } else {\r\n                            self.hasComment = value;\r\n                            if (self.hasComment) {\r\n                                container.addClass(hasCommentClass);\r\n                            } else {\r\n                                container.removeClass(hasCommentClass);\r\n                            }\r\n                        }\r\n                    },\r\n\r\n                    /**\r\n                     * Parse query string.\r\n                     *\r\n                     * @param {string} query\r\n                     * @return {string}\r\n                     */\r\n                    parseQueryString: function (query) {\r\n                        var vars = query.split(\"&\");\r\n                        var queryString = {};\r\n                        for (var i = 0; i < vars.length; i++) {\r\n                            var pair = vars[i].split(\"=\");\r\n                            var key = decodeURIComponent(pair[0]);\r\n                            var value = decodeURIComponent(pair[1]);\r\n                            // If first entry with this name.\r\n                            if (typeof queryString[key] === \"undefined\") {\r\n                                queryString[key] = decodeURIComponent(value);\r\n                                // If second entry with this name.\r\n                            } else if (typeof queryString[key] === \"string\") {\r\n                                queryString[key] = [queryString[key], decodeURIComponent(value)];\r\n                                // If third or later entry with this name.\r\n                            } else {\r\n                                queryString[key].push(decodeURIComponent(value));\r\n                            }\r\n                        }\r\n                        return queryString;\r\n                    },\r\n\r\n                    /**\r\n                     * Scroll to element.\r\n                     *\r\n                     * @param {jQuery} target\r\n                     * @param {Integer} speed\r\n                     */\r\n                    scrollToElement: function (target, speed) {\r\n                        if (!target.length) {\r\n                            return;\r\n                        }\r\n                        if (typeof speed === 'undefined') {\r\n                            speed = 1000;\r\n                        }\r\n                        var top = target.offset().top;\r\n                        $('html,body').animate({ scrollTop: top }, speed);\r\n                    },\r\n\r\n                    /**\r\n                     * Build referer report link.\r\n                     *\r\n                     * @param {string} link\r\n                     * @param {Integer} id\r\n                     * @returns {string}\r\n                     */\r\n                    buildRefererReportLink: function (link, id) {\r\n                        var self = this;\r\n                        var referer = decodeURIComponent(self.referer);\r\n                        // Add highlight.\r\n                        link += '&referer=' + encodeURIComponent(referer + '&highlight=' + id);\r\n                        return link;\r\n                    },\r\n\r\n                    /**\r\n                     * Handle when Atto has content.\r\n                     *\r\n                     * @param {jQuery} formSelector\r\n                     */\r\n                    triggerAttoHasContent: function (formSelector) {\r\n                        var editorContentWrap = formSelector.find(t.SELECTOR.ATTO.CONTENT_WRAP);\r\n                        var submitBtn = formSelector.find(t.SELECTOR.SUBMIT_BUTTON);\r\n                        submitBtn.removeClass('disabled');\r\n                        submitBtn.prop('disabled', false);\r\n                        editorContentWrap.attr('data-placeholder', '');\r\n                        editorContentWrap.addClass(t.ATTO_CONTENT_TYPE.HAS_CONTENT);\r\n                        editorContentWrap.removeClass(t.ATTO_CONTENT_TYPE.NO_CONTENT);\r\n                    },\r\n\r\n                    /**\r\n                     * Handle when Atto has no content.\r\n                     *\r\n                     * @param {jQuery} formSelector\r\n                     */\r\n                    triggerAttoNoContent: function (formSelector) {\r\n                        var placeholder = formSelector.attr('data-textarea-placeholder');\r\n                        var editorContentWrap = formSelector.find(t.SELECTOR.ATTO.CONTENT_WRAP);\r\n                        var submitBtn = formSelector.find(t.SELECTOR.SUBMIT_BUTTON);\r\n                        submitBtn.addClass('disabled');\r\n                        submitBtn.prop('disabled', true);\r\n                        editorContentWrap.attr('data-placeholder', placeholder);\r\n                        editorContentWrap.addClass(t.ATTO_CONTENT_TYPE.NO_CONTENT);\r\n                        editorContentWrap.removeClass(t.ATTO_CONTENT_TYPE.HAS_CONTENT);\r\n                    },\r\n\r\n                    /**\r\n                     * Set sort depend on sortable array.\r\n                     *\r\n                     * @param {string} string\r\n                     */\r\n                    setSort: function (string) {\r\n                        var self = this;\r\n                        if ($.inArray(string, self.sortable) !== -1) {\r\n                            self.sortFeature = string;\r\n                        }\r\n                    },\r\n\r\n                    /**\r\n                     * Begin to load the fragment form for editing.\r\n                     *\r\n                     * @param {Object} item\r\n                     */\r\n                    getFragmentEditFormEvent: function (item) {\r\n                        var self = this;\r\n                        var el = self.elementSelector.find(t.SELECTOR.COMMENT_ID + item.id);\r\n                        var fragmentForm = el.find(t.SELECTOR.FRAGMENT_FORM).first();\r\n                        var postFooter = el.find(t.SELECTOR.POST_FOOTER).first();\r\n                        var clone = self.loadingIcon.clone().show();\r\n                        fragmentForm.append(clone);\r\n                        fragmentForm.removeClass('reply');\r\n                        fragmentForm.addClass('edit');\r\n                        self.loadFragmentEditForm(fragmentForm, item);\r\n                        self.changeWorkingState(true, postFooter);\r\n                    },\r\n\r\n                    /**\r\n                     * Call web services to get the fragment edit form, append to the DOM then bind event.\r\n                     *\r\n                     * @param {jQuery} fragmentForm\r\n                     * @param {Object} item\r\n                     */\r\n                    loadFragmentEditForm: function (fragmentForm, item) {\r\n                        var self = this;\r\n                        M.util.js_pending(t.ACTION_LOAD_FRAGMENT_EDIT_FORM);\r\n                        var params = self.getParamsBeforeCallApi({\r\n                            cancelbutton: true,\r\n                            forcecommenting: self.forceCommenting,\r\n                            commentid: item.id\r\n                        });\r\n                        // Clear error message on the main form to prevent Atto editor from focusing to old message.\r\n                        var attoWrap = self.formSelector.find(t.SELECTOR.ATTO_EDITOR_WRAP);\r\n                        if (attoWrap.length !== 0 && attoWrap.hasClass('error')) {\r\n                            attoWrap.removeClass('error');\r\n                            attoWrap.find('#id_error_message_5btext_5d').remove();\r\n                        }\r\n                        fragment.loadFragment(\r\n                            'mod_studentquiz',\r\n                            t.FRAGMENT_EDIT_FORM_CALLBACK,\r\n                            self.contextId,\r\n                            params\r\n                        ).done(function (html, js) {\r\n                            Templates.replaceNodeContents(fragmentForm, html, js);\r\n                            // Focus form.\r\n                            var textFragmentFormId = '#id_editor_question_' + self.questionId + '_' + item.id + 'editable';\r\n                            fragmentForm.find(textFragmentFormId).focus();\r\n                            self.bindFragmentEditFormEvent(fragmentForm, item);\r\n                            M.util.js_complete(t.ACTION_LOAD_FRAGMENT_EDIT_FORM);\r\n                        });\r\n                    },\r\n\r\n                    /**\r\n                     * Bind fragment edit form action button event.\r\n                     *\r\n                     * @param {jQuery} fragmentForm\r\n                     * @param {Object} item\r\n                     */\r\n                    bindFragmentEditFormEvent: function (fragmentForm, item) {\r\n                        var self = this;\r\n                        var formFragmentSelector = fragmentForm.find(t.SELECTOR.COMMENT_AREA_FORM);\r\n                        fragmentForm.find(t.SELECTOR.SUBMIT_BUTTON).click(function (e) {\r\n                            e.preventDefault();\r\n                            self.changeWorkingState(true);\r\n                            var data = self.convertFormToJson(formFragmentSelector);\r\n                            // Check message field.\r\n                            if (data['message[text]'].length === 0) {\r\n                                return true; // Return true to trigger form validation and show error messages.\r\n                            }\r\n                            var clone = self.loadingIcon.clone().show();\r\n                            clone.appendTo(fragmentForm);\r\n                            formFragmentSelector.hide();\r\n                            self.editCommentEvent(fragmentForm, item, formFragmentSelector, data);\r\n                            return true;\r\n                        });\r\n                        self.fragmentFormCancelEvent(formFragmentSelector, true);\r\n                        self.bindEditorEvent(fragmentForm);\r\n                    },\r\n\r\n                    /**\r\n                     * Edit comment event.\r\n                     *\r\n                     * @param {jQuery} container\r\n                     * @param {Object} item\r\n                     * @param {jQuery} formSelector\r\n                     * @param {Object} formData\r\n                     */\r\n                    editCommentEvent: function (container, item, formSelector, formData) {\r\n                        var self = this;\r\n                        M.util.js_pending(t.ACTION_EDIT);\r\n                        var params = {\r\n                            commentid: item.id,\r\n                            message: {\r\n                                text: formData['message[text]'],\r\n                                format: formData['message[format]'],\r\n                            }\r\n                        };\r\n                        self.editComment(params).then(function (response) {\r\n                            // Hide error if exists.\r\n                            $(t.SELECTOR.COMMENT_ERROR).addClass('hide');\r\n                            var el = self.elementSelector.find(t.SELECTOR.COMMENT_ID + item.id);\r\n                            self.lastFocusElement = el.find(t.SELECTOR.BTN_EDIT);\r\n                            if (self.lastFocusElement.length === 0) {\r\n                                self.lastFocusElement = el.find(t.SELECTOR.BTN_EDIT_REPLY);\r\n                            }\r\n                            // Assign new content.\r\n                            item.shortcontent = response.shortcontent;\r\n                            response.expanded = item.expanded;\r\n                            Templates.render(t.TEMPLATE_COMMENT, response).done(function (html) {\r\n                                var el = $(html);\r\n                                var commentTextSelector = t.SELECTOR.COMMENT_ID + response.id + ' ' + t.SELECTOR.COMMENT_TEXT;\r\n                                $(commentTextSelector).parent().html(el.find(t.SELECTOR.COMMENT_TEXT).parent().html());\r\n                            });\r\n                            container.empty();\r\n                            self.changeWorkingState(false);\r\n                            M.util.js_complete(t.ACTION_EDIT);\r\n                            return true;\r\n                        }).fail(function (e) {\r\n                            self.handleFailWhenCreateComment(e, params);\r\n                            M.util.js_complete(t.ACTION_EDIT);\r\n                        });\r\n                    },\r\n\r\n                    /**\r\n                     * Call web services to edit comment.\r\n                     *\r\n                     * @param {Object} data\r\n                     * @returns {Promise}\r\n                     */\r\n                    editComment: function (data) {\r\n                        var self = this;\r\n                        data = self.getParamsBeforeCallApi(data);\r\n                        var promise = ajax.call([{\r\n                            methodname: t.ACTION_EDIT,\r\n                            args: data\r\n                        }]);\r\n                        return promise[0];\r\n                    },\r\n\r\n                    /**\r\n                     * Check editor content.\r\n                     *\r\n                     * @param {jQuery} formSelector\r\n                     */\r\n                    checkEditorContent: function (formSelector) {\r\n                        var key = 'text_change_' + Date.now();\r\n                        M.util.js_pending(key);\r\n                        var textareaSelector = formSelector.find(t.SELECTOR.TEXTAREA);\r\n                        var attoEditableId = textareaSelector.attr('id') + 'editable';\r\n                        var attoEditableEle = $('#' + attoEditableId);\r\n                        if (t.EMPTY_CONTENT.indexOf(attoEditableEle.html()) > -1 ||\r\n                            attoEditableEle.text().trim().length < 1) {\r\n                            this.triggerAttoNoContent(formSelector);\r\n                        } else {\r\n                            this.triggerAttoHasContent(formSelector);\r\n                        }\r\n                        M.util.js_complete(key);\r\n                    }\r\n                };\r\n            },\r\n            generate: function (params) {\r\n                t.get().init(params);\r\n            }\r\n        };\r\n        return t;\r\n    });\r\n"],"file":"comment_area.min.js"}